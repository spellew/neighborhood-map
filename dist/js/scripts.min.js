"use strict";var loadScriptAsync=function(t){var e=document.createElement("script");e.async=!1,e.onload=t.onLoad,e.onerror=t.onError,e.src=t.src,document.head.appendChild(e)},handleLeafletLoad=function(){loadScriptAsync({src:"js/lib/leaflet.smoothmarkerbouncing.js",onLoad:handleBouncingLoad,onError:handleBouncingError});var t=L.map("map",{zoom:13,center:[0,0],keyboard:!1});L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:"pk.eyJ1Ijoic3BlbGxldyIsImEiOiJjamNqdW5iazgzazI0MndudGh6NjVqM2xrIn0.VML7TdhGwdJlFXauBgwheQ"}).addTo(t),window.map=t},handleLeafletError=function(){alert("There was an error loading in the map, please try again later.")},handleBouncingLoad=function(){loadScriptAsync({src:"https://maps.googleapis.com/maps/api/js?key=AIzaSyDQOrqZ1s3pzisd-dwjrBep3sTguZ7rm6U&libraries=places",onError:handlePlacesError,onLoad:handlePlacesLoad})},handleBouncingError=function(){alert("There was a problem animating the markers bouncing. They'll still be displayed, just static."),loadScriptAsync({src:"https://maps.googleapis.com/maps/api/js?key=AIzaSyDQOrqZ1s3pzisd-dwjrBep3sTguZ7rm6U&libraries=places",onError:handlePlacesError,onLoad:handlePlacesLoad})},handlePlacesLoad=function(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){var e={location:{lat:t.coords.latitude,lng:t.coords.longitude},radius:5e3,type:["point_of_interest"]},o=new google.maps.places.PlacesService(document.createElement("div"));window.geolocatedCoordinates=t.coords,o.nearbySearch(e,function(t){t.length?(t.forEach(function(e){if(!e.fetching&&!e.fetched){var t=e.geometry.location,o=new Headers,n={latitude:t.lat(),longitude:t.lng()};o.append("Authorization","Bearer jUL5Qrgqy7eslfY1y5PvSVgs_RKYZgLLsib9NIJEFUC5JEfjrzBBoN56g_ZBVb-R_NFJC_qtY-jchsSKYBnc0cIOOqxMJtWo4brlDaUCcmklzzC2vyLDob_ZlIP7WnYx");var a="https://api.yelp.com/v3/businesses/search?"+Object.keys(n).map(function(t){return t+"="+n[t]}).join("&");console.log("url:",a),console.log("hasAuth",o.has("Authorization")),fetch(a,{headers:o}).then(function(t){return t.json()}).then(function(t){console.log("data",t),e.fetching=!1,e.fetched=!0})}e.fetching=!0}),displayLocations(t)):(alert("It seems like there are no places nearby your location. Displaying fallback..."),displayLocations(fallbackLocations,!0))})},function(){alert("Something seems to have gone wrong getting your location. Displaying fallback..."),displayLocations(fallbackLocations,!0)}):(alert("It seems like your browser is missing the Geolocation API. Displaying fallback..."),displayLocations(fallbackLocations,!0))},handlePlacesError=function(){alert("There was an error getting places near you. Displaying fallback..."),displayLocations(fallbackLocations,!0)},displayLocations=function(t,i){ko.applyBindings(new function(){var r=this,n=window.map,a=L.featureGroup();r.filter=ko.observable(""),r.locations=ko.observableArray(t),r.filteredLocations=ko.observableArray(r.locations()),r.isDrawerOpen=ko.observable(!0),r.toggleDrawer=function(){r.isDrawerOpen(!r.isDrawerOpen()),n.invalidateSize()},r.redrawMarkers=function(){a.clearLayers(),r.filteredLocations().forEach(function(t){var e=t.geometry.location,o=L.marker(i?[e.lat,e.lng]:[e.lat(),e.lng()]).setBouncingOptions({exclusive:!0}).addTo(n);t.marker=o,t.focused=!1,o.bindPopup(L.popup({closeOnClick:!1,closeOnEscapeKey:!1}).setContent(r.setPopupContent(t))),o.on("mouseover",function(){r.handleMarkerMouseOver(t)}),o.on("mouseout",function(){r.handleMarkerMouseOut(t)}),o.on("click",function(){r.handleMarkerClick(t)}),a.addLayer(o)}),a.getLayers().length&&n.fitBounds(a.getBounds(),{padding:[50,50]})},r.setPopupContent=function(t){},r.handleMarkerMouseOver=function(t){t.marker.bounce()},r.handleMarkerMouseOut=function(t){t.focused||t.marker.stopBouncing()},r.handleMarkerClick=function(t){var e=t.name;r.filter(e),r.filterLocations(null,null,e),t.marker.openPopup(),Array.from(document.getElementsByClassName("leaflet-popup-close-button")).forEach(function(t){t.addEventListener("click",r.resetFilter)}),t.focused=!0,t.marker.bounce(),window.scrollTo(0,0)},r.filterLocations=function(t,e,o){var n=(e?e.target.value:o).toLowerCase(),a=r.locations().filter(function(t){return t.name.toLowerCase().includes(n)});r.filteredLocations(a),r.redrawMarkers()},r.resetFilter=function(){r.filter(""),r.filteredLocations(r.locations()),r.redrawMarkers()},a.addTo(n),r.redrawMarkers()})},fallbackLocations=[{name:"Royalton New York",geometry:{location:{lat:40.7554202,lng:-73.9823776},viewport:{south:40.7542298697085,west:-73.9836466302915,north:40.7569278302915,east:-73.98094866970848}},photo:"https://lh3.googleusercontent.com/p/AF1QipPRED6my9PF1sl8D1FFpFufLbRTAcKi0gaNySpV=w200-h200-k",rating:4.1,vicinity:"44 West 44th Street, New York"},{name:"Times Square",geometry:{location:{lat:40.758895,lng:-73.98513100000002},viewport:{south:40.75512685,west:-73.98689819999998,north:40.76082705000001,east:-73.98386779999998}},photo:"https://lh3.googleusercontent.com/p/AF1QipMcznhQA_ue4Jdc4Rn53OCRSpbqNTTWcVbb12rG=w200-h200-k",rating:4.6,vicinity:"Manhattan"},{name:"DoubleTree Suites by Hilton Hotel New York City - Times Square",geometry:{location:{lat:40.7589917,lng:-73.98452980000002},viewport:{south:40.7576749697085,west:-73.98598838029147,north:40.7603729302915,east:-73.98329041970851}},photo:"https://lh3.googleusercontent.com/p/AF1QipM6yYgf9KEX3mXB4Kzd-OUyeNuMCeJ1ssTRI9Zs=w200-h200-k",rating:4.2,vicinity:"1568 Broadway, New York"},{name:"New York Marriott Marquis",geometry:{location:{lat:40.7586524,lng:-73.98619489999999},viewport:{south:40.7572200697085,west:-73.98784128029149,north:40.75991803029149,east:-73.98514331970853}},photo:"https://lh3.googleusercontent.com/p/AF1QipOHi2AGYRxNb0m_25s7bSzsb7NiGsViO21pGEsY=w200-h200-k",rating:4.3,vicinity:"1535 Broadway, New York"},{name:"Kimpton Muse Hotel",geometry:{location:{lat:40.7578857,lng:-73.98375920000001},viewport:{south:40.7565848697085,west:-73.98504658029151,north:40.7592828302915,east:-73.98234861970849}},photo:"https://lh3.googleusercontent.com/p/AF1QipPaxekKMzxR3U5lxgfWa3aahIE_yYZNT0GjVlaX=w200-h200-k",rating:4.4,vicinity:"130 West 46th Street, New York"},{name:"Broadway @ Times Square Hotel",geometry:{location:{lat:40.75811179999999,lng:-73.983429},viewport:{south:40.7566822697085,west:-73.98485143029149,north:40.7593802302915,east:-73.98215346970846}},photo:"https://lh3.googleusercontent.com/p/AF1QipO11PwCEBlGAB6Mix6DZGY8rGzYvFE138AQ7bWQ=w200-h200-k",rating:4.1,vicinity:"129 West 46th Street, New York"},{name:"Crowne Plaza Times Square Manhattan",geometry:{location:{lat:40.76061099999999,lng:-73.98507569999998},viewport:{south:40.7593571197085,west:-73.98646508029151,north:40.7620550802915,east:-73.98376711970849}},photo:"https://lh3.googleusercontent.com/p/AF1QipPvYkQ5JNWab0VrRx1Wu5gH7aPZ-mVLJFXV0uv0=w200-h200-k",rating:4.2,vicinity:"1605 Broadway, New York"},{name:"Night Theater District",geometry:{location:{lat:40.7572369,lng:-73.98441309999998},viewport:{south:40.7559619197085,west:-73.98563968029151,north:40.7586598802915,east:-73.98294171970849}},photo:"https://lh3.googleusercontent.com/p/AF1QipPappgu5E6NVPyDCOaTvDg-4PEFTkjW25Frw8ss=w200-h200-k",rating:3.9,vicinity:"132 West 45th Street, New York"},{name:"Room Mate Grace Hotel",geometry:{location:{lat:40.7574442,lng:-73.98383059999998},viewport:{south:40.75602241970851,west:-73.98524633029149,north:40.75872038029151,east:-73.98254836970852}},photo:"https://lh3.googleusercontent.com/p/AF1QipOIvju5B9Oq59Z_g7gPK8SjRMblAIstt5qYCrBZ=w200-h200-k",rating:4.4,vicinity:"125 West 45th Street, New York"},{name:"Millennium Broadway Hotel New York",geometry:{location:{lat:40.75715599999999,lng:-73.984803},viewport:{south:40.7556717697085,west:-73.98621998029148,north:40.7583697302915,east:-73.98352201970852}},photo:"https://lh3.googleusercontent.com/p/AF1QipP4wmhzgQlHIIeS5NRa5xotrVXlAiKtqMxhQ2kA=w200-h200-k",rating:3.9,vicinity:"145 West 44th Street, New York"},{name:"The Time New York",geometry:{location:{lat:40.760978,lng:-73.985501},viewport:{south:40.7597141197085,west:-73.98677108029153,north:40.7624120802915,east:-73.98407311970851}},photo:"https://lh3.googleusercontent.com/p/AF1QipPrrurks0riB9igW_wSFfGs2d96USxyxalSQUiZ=w200-h200-k",rating:4.1,vicinity:"224 West 49th Street, New York"},{name:"Hotel St. James",geometry:{location:{lat:40.75723670000001,lng:-73.98325549999998},viewport:{south:40.75579911970851,west:-73.98467598029151,north:40.7584970802915,east:-73.98197801970849}},photo:"https://lh3.googleusercontent.com/p/AF1QipOVi-XGc4diOYs5uK7_pttBMSOFblG_UgjjgeIw=w200-h200-k",rating:3.9,vicinity:"109 West 45th Street, New York"},{name:"AKA Times Square",geometry:{location:{lat:40.75678499999999,lng:-73.98417899999998},viewport:{south:40.75535136970849,west:-73.98559068029152,north:40.75804933029149,east:-73.9828927197085}},photo:"https://lh3.googleusercontent.com/p/AF1QipPuGDcfoqW_QRLIL9xqvtT7mF6TM5kl-Vxscfdg=w200-h200-k",rating:4.4,vicinity:"123 West 44th Street, New York"},{name:"The Chatwal, a Luxury Collection Hotel, New York City",geometry:{location:{lat:40.7565183,lng:-73.98460169999998},viewport:{south:40.7552544197085,west:-73.98588763029153,north:40.7579523802915,east:-73.98318966970851}},photo:"https://lh3.googleusercontent.com/p/AF1QipNoX2zATsbnBrymY_TU3VfkKhqmf2THyeuh2qtC=w200-h200-k",rating:4.5,vicinity:"130 West 44th Street, New York"},{name:"New York Inn",geometry:{location:{lat:40.7603197,lng:-73.98777849999999},viewport:{south:40.7589244697085,west:-73.9890365802915,north:40.7616224302915,east:-73.98633861970848}},photo:"https://lh3.googleusercontent.com/p/AF1QipPdwY_-Fej3lME7dg3o3082AD7Sp2f41lQCOc3u=w200-h200-k",rating:2.8,vicinity:"765 8th Avenue, New York"},{name:"The Pearl Hotel New York",geometry:{location:{lat:40.76136169999999,lng:-73.98558129999998},viewport:{south:40.7599694697085,west:-73.98696203029152,north:40.7626674302915,east:-73.9842640697085}},photo:"https://lh3.googleusercontent.com/p/AF1QipOAuJYXKFL9QnVx7K5DI64VAXhXugkoaH-k86-p=w200-h200-k",rating:4.6,vicinity:"233 West 49th Street, New York"},{name:"Casablanca Hotel by Library Hotel Collection",geometry:{location:{lat:40.7564251,lng:-73.98555340000001},viewport:{south:40.7550428697085,west:-73.98692708029148,north:40.7577408302915,east:-73.98422911970852}},photo:"https://lh3.googleusercontent.com/p/AF1QipPuaRv8jb8YpgHoL42zgyPs4PVLgDrBxV5P5P7x=w200-h200-k",rating:4.6,vicinity:"147 West 43rd Street, New York"},{name:"Econo Lodge Times Square",geometry:{location:{lat:40.76039600000001,lng:-73.98776399999997},viewport:{south:40.7590042697085,west:-73.98899778029147,north:40.7617022302915,east:-73.9862998197085}},photo:"https://lh3.googleusercontent.com/p/AF1QipManPKdBPm9DloAm-oUPYt2DO6MMbbIeTc4qnyV=w200-h200-k",rating:3.8,vicinity:"302 West 47th Street, New York"},{name:"Hilton Garden Inn Times Square",geometry:{location:{lat:40.7612054,lng:-73.98650680000003},viewport:{south:40.7599300697085,west:-73.98799588029146,north:40.76262803029149,east:-73.9852979197085}},photo:"https://lh3.googleusercontent.com/p/AF1QipMEfGAjbGG6xgsq4ukBqec4orOtu-R9uV2eRxmS=w200-h200-k",rating:4.2,vicinity:"790 8th Avenue, New York"},{name:"Hotel Mela Times Square",geometry:{location:{lat:40.75643159999999,lng:-73.9842868},viewport:{south:40.7551537197085,west:-73.9855915802915,north:40.75785168029149,east:-73.98289361970848}},photo:"https://lh3.googleusercontent.com/p/AF1QipNTK7FXqiinvxeaL1K8I29cO_GFTVbVbaLNcgvr=w200-h200-k",rating:3.9,vicinity:"120 W 44th St, New York"}];