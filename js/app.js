"use strict";var loadScriptAsync=function(e){var o=document.createElement("script");o.async=!1,o.onload=e.onLoad,o.onerror=e.onError,o.src=e.src,document.head.appendChild(o)},handleLeafletLoad=function(){loadScriptAsync({src:"js/lib/leaflet.smoothmarkerbouncing.js",onLoad:handleBouncingLoad,onError:handleBouncingError});var e=L.map("map",{zoom:13,center:[0,0],keyboard:!1});L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:"pk.eyJ1Ijoic3BlbGxldyIsImEiOiJjamNqdW5iazgzazI0MndudGh6NjVqM2xrIn0.VML7TdhGwdJlFXauBgwheQ"}).addTo(e),window.map=e},handleLeafletError=function(){alert("There was an error loading in the map, please try again later.")},handleBouncingLoad=function(){loadScriptAsync({src:"https://maps.googleapis.com/maps/api/js?key=AIzaSyDQOrqZ1s3pzisd-dwjrBep3sTguZ7rm6U&libraries=places",onError:handlePlacesError,onLoad:handlePlacesLoad})},handleBouncingError=function(){alert("There was a problem animating the markers bouncing. They'll still be displayed, just static."),loadScriptAsync({src:"https://maps.googleapis.com/maps/api/js?key=AIzaSyDQOrqZ1s3pzisd-dwjrBep3sTguZ7rm6U&libraries=places",onError:handlePlacesError,onLoad:handlePlacesLoad})},handlePlacesLoad=function(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){var o={location:{lat:e.coords.latitude,lng:e.coords.longitude},radius:5e3,type:["point_of_interest"]},a=new google.maps.places.PlacesService(document.createElement("div"));window.geolocatedCoordinates=e.coords,a.nearbySearch(o,function(e){e.length?displayLocations(e):(alert("It seems like there are no places nearby your location. Displaying fallback..."),displayLocations(fallbackLocations,!0))})},function(){alert("Something seems to have gone wrong getting your location. Displaying fallback..."),displayLocations(fallbackLocations,!0)}):(alert("It seems like your browser is missing the Geolocation API. Displaying fallback..."),displayLocations(fallbackLocations,!0))},handlePlacesError=function(){alert("There was an error getting places near you. Displaying fallback..."),displayLocations(fallbackLocations,!0)},displayLocations=function(e,i){ko.applyBindings(new function(){var t=this,n=window.map,r=L.featureGroup();t.filter=ko.observable(""),t.locations=ko.observableArray(e),t.filteredLocations=ko.observableArray(t.locations()),t.isDrawerOpen=ko.observable(!0),t.toggleDrawer=function(){t.isDrawerOpen(!t.isDrawerOpen()),n.invalidateSize()},t.redrawMarkers=function(){r.clearLayers(),t.filteredLocations().forEach(function(e){var o=e.geometry.location,a=L.marker(i?[o.lat,o.lng]:[o.lat(),o.lng()]).setBouncingOptions({exclusive:!0}).addTo(n);!i&&e.photos&&(e.photo=e.photos[0].getUrl({maxWidth:200,maxHeight:200})),e.marker=a,e.focused=!1,a.bindPopup(L.popup({closeOnClick:!1,closeOnEscapeKey:!1}).setContent(t.setPopupContent(e))),a.on("mouseover",function(){t.handleMarkerMouseOver(e)}),a.on("mouseout",function(){t.handleMarkerMouseOut(e)}),a.on("click",function(){t.handleMarkerClick(e)}),r.addLayer(a)}),r.getLayers().length&&n.fitBounds(r.getBounds(),{padding:[50,50]})},t.setPopupContent=function(e){return e.photo?'<figure>\n          <img class="photo-popup" src="'+e.photo+'" alt="'+e.name+'" />\n          <figcaption>'+e.name+"</figcaption>\n        </figure>":"<figcaption>"+e.name+"</figcaption>"},t.handleMarkerMouseOver=function(e){e.marker.bounce()},t.handleMarkerMouseOut=function(e){e.focused||e.marker.stopBouncing()},t.handleMarkerClick=function(e){var o=e.name;t.filter(o),t.filterLocations(null,null,o),e.marker.openPopup(),Array.from(document.getElementsByClassName("leaflet-popup-close-button")).forEach(function(e){e.addEventListener("click",t.resetFilter)}),e.focused=!0,e.marker.bounce(),window.scrollTo(0,0)},t.filterLocations=function(e,o,a){var n=(o?o.target.value:a).toLowerCase(),r=t.locations().filter(function(e){return e.name.toLowerCase().includes(n)});t.filteredLocations(r),t.redrawMarkers()},t.resetFilter=function(){t.filter(""),t.filteredLocations(t.locations()),t.redrawMarkers()},r.addTo(n),t.redrawMarkers()})};